import random
import requests
import json

def get_korean_districts_from_api():
    url = "https://apis.openapi.sk.com/puzzle/travel/meta/districts?type=ri"
    headers = {
        "appkey": "tBXyxqucgs6GWby9l8reg7cfV6hTVBgyz6GVauag"  # ì œê³µë°›ì€ API í‚¤ ì‚¬ìš©
    }
    
    try:
        response = requests.get(url, headers=headers)
        response.raise_for_status()
        data = response.json()
        
        # API ì‘ë‹µ ë°ì´í„°ì—ì„œ í•œêµ­ ì§€ì—­ ì •ë³´ ì¶”ì¶œ
        korean_districts = []
        for item in data.get('result', {}).get('districts', []):
            if item.get('country') == 'Korea':  # í•œêµ­ ì§€ì—­ë§Œ í•„í„°ë§
                korean_districts.append({
                    'name': item.get('name'),
                    'description': item.get('description', 'í•œêµ­ì˜ ì•„ë¦„ë‹¤ìš´ ì—¬í–‰ì§€')
                })
        return korean_districts
    except requests.exceptions.RequestException as e:
        print(f"API ìš”ì²­ ì‹¤íŒ¨: {e}")
        return []

def travel_recommender():
    print("ğŸŒŸ ëŒ€í•œë¯¼êµ­ ì—¬í–‰ì§€ ì¶”ì²œ í”„ë¡œê·¸ë¨ (SK Open API ì—°ë™) ğŸŒŸ")
    print("=" * 50)
   
    # ì‚¬ìš©ì ì„ í˜¸ë„ ì¡°ì‚¬
    print("\nì—¬í–‰ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš” (1-5):")
    budget = int(input("ì˜ˆì‚° (1: ì €ì˜ˆì‚° ~ 5: ê³ ì˜ˆì‚°): "))
    activity = int(input("í™œë™ì„± (1: íœ´ì‹ ~ 5: ëª¨í—˜): "))
    culture = int(input("ë¬¸í™”/ì—­ì‚¬ ê´€ì‹¬ë„ (1: ë‚®ìŒ ~ 5: ë†’ìŒ): "))
    food = int(input("ìŒì‹ ê´€ì‹¬ë„ (1: ë‚®ìŒ ~ 5: ë†’ìŒ): "))
    climate = int(input("ì„ í˜¸ ê¸°í›„ (1: ì¶”ì›€ ~ 3: ì¤‘ë¦½ ~ 5: ë”ì›€): "))
    
    # APIì—ì„œ í•œêµ­ ì§€ì—­ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    api_districts = get_korean_districts_from_api()
    
    # ê¸°ë³¸ êµ­ë‚´ ì—¬í–‰ì§€ ë°ì´í„° (APIê°€ ì—†ì„ ê²½ìš° ì‚¬ìš©)
    destinations = {
        "ì„œìš¸": {
            "budget": 4, "activity": 5, "culture": 5, "food": 5, "climate": 3,
            "desc": "í˜„ëŒ€ì™€ ì „í†µì´ ê³µì¡´í•˜ëŠ” ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„"
        },
        "ë¶€ì‚°": {
            "budget": 3, "activity": 4, "culture": 4, "food": 5, "climate": 4,
            "desc": "ë°”ë‹¤ì™€ ë„ì‹œê°€ ì–´ìš°ëŸ¬ì§„ í™œê¸°ì°¬ í•­êµ¬ë„ì‹œ"
        },
        "ì œì£¼ë„": {
            "budget": 3, "activity": 5, "culture": 3, "food": 4, "climate": 4,
            "desc": "ì•„ë¦„ë‹¤ìš´ ìì—°ê²½ê´€ê³¼ ë…íŠ¹í•œ ë¬¸í™”ë¥¼ ê°€ì§„ ì„¬"
        },
        "ê²½ì£¼": {
            "budget": 2, "activity": 2, "culture": 5, "food": 3, "climate": 3,
            "desc": "ì‹ ë¼ì˜ ì—­ì‚¬ì™€ ë¬¸í™”ê°€ ì‚´ì•„ìˆ¨ì‰¬ëŠ” ê³ ë„"
        },
        "ê°•ë¦‰": {
            "budget": 3, "activity": 3, "culture": 4, "food": 4, "climate": 3,
            "desc": "ì•„ë¦„ë‹¤ìš´ í•´ì•ˆê³¼ ë§›ìˆëŠ” ì»¤í”¼ë¡œ ìœ ëª…í•œ ë™í•´ì•ˆ ë„ì‹œ"
        }
    }
    
    # APIì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ destinations ì—…ë°ì´íŠ¸
    for district in api_districts:
        name = district.get('name', '')
        if name and name not in destinations:
            destinations[name] = {
                "budget": random.randint(2, 4),
                "activity": random.randint(2, 5),
                "culture": random.randint(2, 5),
                "food": random.randint(3, 5),
                "climate": random.randint(2, 4),
                "desc": district.get('description', f"{name} ì§€ì—­ì˜ ì•„ë¦„ë‹¤ìš´ ì—¬í–‰ì§€")
            }
   
    # ì„ í˜¸ë„ ì ìˆ˜ ê³„ì‚°
    recommendations = []
    for dest, attrs in destinations.items():
        score = 0
        score += 5 - abs(budget - attrs["budget"])
        score += 5 - abs(activity - attrs["activity"])
        score += 5 - abs(culture - attrs["culture"])
        score += 5 - abs(food - attrs["food"])
        score += 5 - abs(climate - attrs["climate"])
        recommendations.append((dest, score, attrs["desc"]))
   
    # ìƒìœ„ 3ê°œ ì¶”ì²œ
    recommendations.sort(key=lambda x: x[1], reverse=True)
   
    print("\n" + "=" * 50)
    print("ğŸ† ë‹¹ì‹ ì„ ìœ„í•œ ìµœê³ ì˜ êµ­ë‚´ ì—¬í–‰ì§€ ì¶”ì²œ ğŸ†")
    print("=" * 50)
   
    for i, (dest, score, desc) in enumerate(recommendations[:3], 1):
        print(f"\n{i}ìœ„: {dest} (ì í•©ë„: {score}/25)")
        print(f"ğŸ“Œ {desc}")
   
    # ëœë¤ ì¶”ì²œ (APIì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ìš°ì„ )
    if api_districts:
        random_rec = random.choice(api_districts)
        print("\n" + "=" * 50)
        print(f"ğŸ² ì˜¤ëŠ˜ì˜ API ëœë¤ ì¶”ì²œ: {random_rec.get('name', '')}")
        print(f"ğŸ“Œ {random_rec.get('description', 'APIì—ì„œ ì œê³µí•˜ëŠ” í•œêµ­ ì—¬í–‰ì§€')}")
    else:
        random_rec = random.choice(list(destinations.items()))
        print("\n" + "=" * 50)
        print(f"ğŸ² ì˜¤ëŠ˜ì˜ ëœë¤ ì¶”ì²œ: {random_rec[0]}")
        print(f"ğŸ“Œ {random_rec[1]['desc']}")
    print("=" * 50)

if __name__ == "__main__":
    travel_recommender()
